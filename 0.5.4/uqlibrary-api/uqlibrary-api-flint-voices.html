<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-ajax/core-ajax.html">
<link rel="import" href="uqlibrary-api.html">

<!--
Element providing list of voices for Flint language survey

##### Example

    <uqlibrary-api-flint-voices></uqlibrary-api-flint-voices>

@element uqlibrary-api-flint-voices
@blurb Element providing list of voices for Flint language survey
@status alpha
@homepage https://github.com/uqlibrary/uqlibrary-api
-->
<polymer-element name="uqlibrary-api-flint-voices" extends="uqlibrary-api">

  <template>
    <uqlibrary-api id="list"></uqlibrary-api>
  </template>

  <script>
    (function() {
      Polymer('uqlibrary-api-flint-voices', {


        baseUri : '/flint/voices',
        /**
         * Fired when the object has loaded.
         *
         * @event uqlibrary-api-flint-voices
         */
        created: function () {
        },

        ready: function () {
          var that = this;
          this.$.list.addEventListener('uqlibrary-api', function(e) {
            that.data = e.detail;

            //order data
            that.data.sort(function(item1, item2) {
              if (item1.cvo_title < item2.cvo_title)
                return -1;
              else
                return 1;
            });

            //create an index of letter/item count
            var letterCountList = [];
            that.data.forEach(function(item){
              var startLetter = item.cvo_title[0].toUpperCase();

              if (letterCountList[startLetter]) {
                letterCountList[startLetter] = letterCountList[startLetter] + 1;
              } else {
                letterCountList[startLetter] = 1;
              }
            });

            //create a group structure
            var groups = [];
            for(var letter in letterCountList) {
              groups.push({
                length: letterCountList[letter],
                data: {
                  label: letter
                }
              });
            }

            that.fire('uqlibrary-api-flint-voices-loaded', {items: that.data, groups: groups});
          });
        },

        /**
         * Gets results
         *
         * @method get
         */
        get: function (args) {
            this.$.list.uri = this.baseUri;
            this.$.list.get();
        }
      });
    })();
  </script>

</polymer-element>